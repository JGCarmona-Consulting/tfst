# devops/azure-pipelines/templates/fetch_app_service_name.yml
parameters:
  - name: terragrunt_path
    type: string

steps:
  - bash: |
      echo "Changing to directory: $(System.DefaultWorkingDirectory)/${{ parameters.terragrunt_path }}"
      cd "$(System.DefaultWorkingDirectory)/${{ parameters.terragrunt_path }}" || {
        echo "Error: Directory not found: $(System.DefaultWorkingDirectory)/${{ parameters.terragrunt_path }}"
        exit 1
      }
      APP_SERVICE_NAME=$(terragrunt output -json | jq -r '.name.value')
      echo "##vso[task.setvariable variable=APP_SERVICE_NAME]$APP_SERVICE_NAME"
      if [ -z "$APP_SERVICE_NAME" ]; then
        echo "Error: APP_SERVICE_NAME is empty. Check Terraform outputs."
        exit 1
      fi
    displayName: "Fetch App Service Name from Terraform Outputs"    
    env:
      ARM_SUBSCRIPTION_ID: $(ARM_SUBSCRIPTION_ID)
      ARM_CLIENT_ID: $(ARM_CLIENT_ID)
      ARM_CLIENT_SECRET: $(ARM_CLIENT_SECRET)
      ARM_TENANT_ID: $(ARM_TENANT_ID)
